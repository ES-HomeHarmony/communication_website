"use strict";(self.webpackChunkmicrosite=self.webpackChunkmicrosite||[]).push([[4638],{2638:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>a});var i=t(4848),o=t(8453);const s={sidebar_position:5},r="AWS Cognito",c={id:"cognito",title:"AWS Cognito",description:"This document explains the step-by-step process of configuring AWS Cognito and connecting the React frontend with the Identity Provider (IDP). The implementation involves setting up AWS Cognito for user authentication and handling the JWT tokens in the React application.",source:"@site/docs/cognito.md",sourceDirName:".",slug:"/cognito",permalink:"/communication_website/docs/cognito",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"ECS Deployment",permalink:"/communication_website/docs/microservices_deployment"},next:{title:"AWS RDS",permalink:"/communication_website/docs/aws_rds"}},l={},a=[{value:"Cognito Configuration",id:"cognito-configuration",level:2},{value:"1. Create a User Pool",id:"1-create-a-user-pool",level:3},{value:"2. Configure App Client",id:"2-configure-app-client",level:3},{value:"3. Configure App Client Settings",id:"3-configure-app-client-settings",level:3},{value:"4. Domain Setup",id:"4-domain-setup",level:3},{value:"Frontend Configuration",id:"frontend-configuration",level:2},{value:"1. Redirect Users to Cognito Hosted UI",id:"1-redirect-users-to-cognito-hosted-ui",level:3},{value:"2. Handling Redirect and JWT Tokens",id:"2-handling-redirect-and-jwt-tokens",level:3},{value:"Handling JWT Tokens",id:"handling-jwt-tokens",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"aws-cognito",children:"AWS Cognito"})}),"\n",(0,i.jsx)(n.p,{children:"This document explains the step-by-step process of configuring AWS Cognito and connecting the React frontend with the Identity Provider (IDP). The implementation involves setting up AWS Cognito for user authentication and handling the JWT tokens in the React application."}),"\n",(0,i.jsx)(n.h2,{id:"cognito-configuration",children:"Cognito Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"1-create-a-user-pool",children:"1. Create a User Pool"}),"\n",(0,i.jsx)(n.p,{children:"To start, we need to create a User Pool in AWS Cognito to manage user sign-up, sign-in, and authentication."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 1"}),": Navigate to AWS Cognito in the AWS Management Console."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 2"}),": Create a new User Pool by clicking ",(0,i.jsx)(n.strong,{children:'"Create a User Pool"'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 3"}),": Configure the User Pool with the following settings:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Allow email addresses as the primary identifier for users."}),"\n",(0,i.jsx)(n.li,{children:"Set password policy as needed (e.g., minimum length, character requirements)."}),"\n",(0,i.jsx)(n.li,{children:"Enable Multi-Factor Authentication (optional)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 4"}),": Click ",(0,i.jsx)(n.strong,{children:'"Next"'})," and complete the creation process."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-configure-app-client",children:"2. Configure App Client"}),"\n",(0,i.jsx)(n.p,{children:"After creating the User Pool, you need to create an App Client for the frontend to interact with Cognito."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 1"}),": In your Cognito User Pool, go to ",(0,i.jsx)(n.strong,{children:"App Clients"})," and click ",(0,i.jsx)(n.strong,{children:'"Add an App Client"'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 2"}),": Disable the ",(0,i.jsx)(n.strong,{children:"Generate client secret"})," option (as it is not recommended for public-facing applications like React)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 3"}),": Specify the OAuth 2.0 flows that will be used. Enable the following:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Authorization code grant"}),"\n",(0,i.jsxs)(n.li,{children:["Implicit grant (to obtain ",(0,i.jsx)(n.code,{children:"id_token"})," and ",(0,i.jsx)(n.code,{children:"access_token"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 4"}),": Save the App Client configuration."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-configure-app-client-settings",children:"3. Configure App Client Settings"}),"\n",(0,i.jsx)(n.p,{children:"Now, configure the App Client to integrate with your React frontend."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 1"}),": In the ",(0,i.jsx)(n.strong,{children:"App client settings"})," section, enable ",(0,i.jsx)(n.strong,{children:"Cognito User Pool"})," as an identity provider."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 2"}),": Set the ",(0,i.jsx)(n.strong,{children:"Callback URL"})," to the URL of your React application (e.g., ",(0,i.jsx)(n.code,{children:"http://localhost:3000"}),"). This is where Cognito will redirect users after they log in."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 3"}),": Set the ",(0,i.jsx)(n.strong,{children:"Sign-out URL"})," to the same React application URL (e.g., ",(0,i.jsx)(n.code,{children:"http://localhost:3000"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 4"}),": Select the OAuth 2.0 scopes you want (e.g., ",(0,i.jsx)(n.code,{children:"openid"}),", ",(0,i.jsx)(n.code,{children:"email"}),", ",(0,i.jsx)(n.code,{children:"profile"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 5"}),": Save the settings."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-domain-setup",children:"4. Domain Setup"}),"\n",(0,i.jsx)(n.p,{children:"Cognito requires a custom domain for hosting the sign-in/sign-up pages (Hosted UI)."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 1"}),": In the ",(0,i.jsx)(n.strong,{children:"Domain name"})," section of the User Pool, choose a domain prefix (e.g., ",(0,i.jsx)(n.code,{children:"your-app-domain"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 2"}),": AWS will provide a domain in the format ",(0,i.jsx)(n.code,{children:"your-app-domain.auth.region.amazoncognito.com"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 3"}),": Save the domain configuration."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"frontend-configuration",children:"Frontend Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Now that Cognito is configured, we need to connect the frontend React application to the AWS Cognito User Pool. This involves redirecting users to the AWS Cognito Hosted UI for authentication and processing the returned JWT tokens."}),"\n",(0,i.jsx)(n.h3,{id:"1-redirect-users-to-cognito-hosted-ui",children:"1. Redirect Users to Cognito Hosted UI"}),"\n",(0,i.jsx)(n.p,{children:"In your React application, create a button to redirect users to the Cognito Hosted UI for login or sign-up."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'const handleLogin = () => {\n  const domain = "your-app-domain.auth.region.amazoncognito.com";\n  const clientId = "your-client-id";\n  const redirectUri = window.location.origin; // e.g., http://localhost:3000\n\n  window.location.href = `https://${domain}/login?client_id=${clientId}&response_type=token&redirect_uri=${redirectUri}`;\n};\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The user is redirected to the Cognito Hosted UI for authentication."}),"\n",(0,i.jsxs)(n.li,{children:["Upon successful login, Cognito will redirect the user back to the ",(0,i.jsx)(n.code,{children:"redirectUri"})," with the JWT tokens."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-handling-redirect-and-jwt-tokens",children:"2. Handling Redirect and JWT Tokens"}),"\n",(0,i.jsxs)(n.p,{children:["Once the user logs in, AWS Cognito will redirect them back to your React application with the tokens included in the URL as hash fragments (e.g., ",(0,i.jsx)(n.code,{children:"#id_token=...&access_token=..."}),")."]}),"\n",(0,i.jsx)(n.p,{children:"Use the following code in your React component to extract and store the tokens:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"useEffect(() => {\n  const hash = window.location.hash;\n  if (hash) {\n    const params = new URLSearchParams(hash.substring(1));\n    const idToken = params.get('id_token');\n    const accessToken = params.get('access_token');\n\n    if (idToken && accessToken) {\n      localStorage.setItem('id_token', idToken);\n      localStorage.setItem('access_token', accessToken);\n    }\n  }\n}, []);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The tokens (",(0,i.jsx)(n.code,{children:"id_token"})," and ",(0,i.jsx)(n.code,{children:"access_token"}),") are stored in ",(0,i.jsx)(n.code,{children:"localStorage"})," for later use in API requests."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"handling-jwt-tokens",children:"Handling JWT Tokens"}),"\n",(0,i.jsxs)(n.p,{children:["Once the tokens are stored, you can use them to make authenticated requests to your backend API by including the ",(0,i.jsx)(n.code,{children:"access_token"})," in the ",(0,i.jsx)(n.code,{children:"Authorization"})," header."]}),"\n",(0,i.jsx)(n.p,{children:"Example of making an authenticated request:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const token = localStorage.getItem('access_token');\n\nfetch('/api/protected-endpoint', {\n  headers: {\n    Authorization: `Bearer ${token}`,\n  },\n})\n  .then(response => response.json())\n  .then(data => console.log(data))\n  .catch(error => console.error('Error:', error));\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The backend can then validate the ",(0,i.jsx)(n.code,{children:"access_token"})," to ensure that the user is authenticated."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"This setup provides an authentication flow for your React application using AWS Cognito without the need for Amplify. It covers user redirection to the AWS Cognito Hosted UI, handling of JWT tokens, and making authenticated API requests."}),"\n",(0,i.jsx)(n.p,{children:"By following these steps, you will have a working authentication system in your React application connected to AWS Cognito, ensuring secure access to your resources."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var i=t(6540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);